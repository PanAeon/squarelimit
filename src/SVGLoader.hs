module SVGLoader where

import qualified Graphics.Svg as Svg
import System.IO.Unsafe

import Diagrams.Prelude
import Diagrams.Backend.SVG.CmdLine

import qualified Graphics.Svg.Types as Svg.Types

svgFish = unsafePerformIO $ maybe (error "no fish") id <$> (Svg.loadSvgFile "fish.svg")

emptyDiag = (lw none $ square 16)

fishToDiagram :: Svg.Document -> Diagram B
fishToDiagram doc = foldl' (\r a -> r <> drawElement a) emptyDiag (Svg.Types._elements doc)

drawElement :: Svg.Tree -> Diagram B 
drawElement (Svg.Types.PathTree (Svg.Path attrs definitions)) = drawSVGDefinitions definitions
drawElement (Svg.Types.GroupTree (Svg.Group attrs children viewBox aspectRatio)) = 
             foldl' (\r a -> r <> drawElement a) emptyDiag children
drawElement e = error $ "can't handle " <> (show e) <> "(yet)"

-- renderSVG "meout.svg" (dims (r2 (800.0, 800.0))) (fishToDiagram svgFish)
-- reverse engineer Diagram => SVG => Diagram?
-- need to fold over the path
drawSVGDefinitions :: [Svg.Types.PathCommand] -> Diagram B
drawSVGDefinitions xs = emptyDiag


{-
Exception: can't handle GroupTree (Group {_groupDrawAttributes = DrawAttributes {_strokeWidth = Last {getLast = Nothing}, _strokeColor = Last {getLast = Just (ColorRef (PixelRGBA8 0 0 0 255))}, _strokeOpacity = Nothing, _strokeLineCap = Last {getLast = Nothing}, _strokeLineJoin = Last {getLast = Nothing}, _strokeMiterLimit = Last {getLast = Nothing}, _fillColor = Last {getLast = Nothing}, _fillOpacity = Nothing, _groupOpacity = Nothing, _transform = Nothing, _fillRule = Last {getLast = Nothing}, _maskRef = Last {getLast = Nothing}, _clipPathRef = Last {getLast = Nothing}, _clipRule = Last {getLast = Nothing}, _attrClass = [], _attrId = Just "fig-8f84b6f75932499f90acbf67d4ed2c68-element-1", _strokeOffset = Last {getLast = Nothing}, _strokeDashArray = Last {getLast = Nothing}, _fontSize = Last {getLast = Nothing}, _fontFamily = Last {getLast = Nothing}, _fontStyle = Last {getLast = Nothing}, _textAnchor = Last {getLast = Nothing}, _markerStart = Last {getLast = Nothing}, _markerMid = Last {getLast = Nothing}, _markerEnd = Last {getLast = Nothing}}, _groupChildren = [PathTree (Path {_pathDrawAttributes = DrawAttributes {_strokeWidth = Last {getLast = Nothing}, _strokeColor = Last {getLast = Nothing}, _strokeOpacity = Nothing, _strokeLineCap = Last {getLast = Nothing}, _strokeLineJoin = Last {getLast = Nothing}, _strokeMiterLimit = Last {getLast = Nothing}, _fillColor = Last {getLast = Nothing}, _fillOpacity = Nothing, _groupOpacity = Nothing, _transform = Nothing, _fillRule = Last {getLast = Nothing}, _maskRef = Last {getLast = Nothing}, _clipPathRef = Last {getLast = Nothing}, _clipRule = Last {getLast = Nothing}, _attrClass = [], _attrId = Nothing, _strokeOffset = Last {getLast = Nothing}, _strokeDashArray = Last {getLast = Nothing}, _fontSize = Last {getLast = Nothing}, _fontFamily = Last {getLast = Nothing}, _fontStyle = Last {getLast = Nothing}, _textAnchor = Last {getLast = Nothing}, _markerStart = Last {getLast = Nothing}, _markerMid = Last {getLast = Nothing}, _markerEnd = Last {getLast = Nothing}}, _pathDefinition = [MoveTo OriginAbsolute [V2 (-0.82) 50.02],CurveTo OriginAbsolute [(V2 (-5.5) 45.85,V2 (-9.45) 42.33,V2 (-12.55) 37.96)],CurveTo OriginRelative [(V2 0.0 (-0.19),V2 0.28 (-0.9),V2 0.61 (-1.56))],CurveTo OriginRelative [(V2 1.91 (-3.8),V2 3.62 (-6.26),V2 7.88 (-11.38))],LineTo OriginRelative [V2 2.28 (-2.74)],LineTo OriginRelative [V2 (-0.11) (-1.16)],CurveTo OriginAbsolute [(V2 (-2.51) 13.72,V2 (-2.15) 8.24,V2 (-0.32) 1.23)],CurveTo OriginAbsolute [(V2 (-9.0e-2) (-0.89),V2 0.42 0.2,V2 3.14 2.23)],CurveTo OriginAbsolute [(V2 6.21 4.71,V2 9.07 6.13,V2 11.96 10.81)],LineTo OriginRelative [V2 3.61 0.16],CurveTo OriginRelative [(V2 4.11 0.18,V2 5.77 0.45,V2 8.12 1.2)],LineTo OriginRelative [V2 1.76 0.56],CurveTo OriginRelative [(V2 2.0e-2 2.3,V2 4.0e-2 4.61,V2 6.0e-2 6.91)],CurveTo OriginRelative [(V2 2.0e-2 1.99,V2 3.0e-2 3.97,V2 5.0e-2 5.96)],CurveTo OriginRelative [(V2 (-2.05) 2.05,V2 (-4.22) 4.51,V2 (-6.27) 6.56)],CurveTo OriginRelative [(V2 2.75 4.47,V2 10.18 6.97,V2 16.65 7.62)],LineTo OriginRelative [V2 2.67 0.24],LineTo OriginRelative [V2 1.87 2.2],CurveTo OriginRelative [(V2 2.11 2.47,V2 3.4 3.59,V2 7.05 6.08)],LineTo OriginRelative [V2 2.54 1.73],CurveTo OriginRelative [(V2 0.26 0.14,V2 1.62 0.95,V2 (-0.29) 0.76)],LineTo OriginRelative [V2 (-3.76) (-0.72)],CurveTo OriginRelative [(V2 (-5.14) (-0.99),V2 (-7.52) (-1.3),V2 (-9.82) (-1.3))],CurveTo OriginRelative [(V2 (-1.83) (-0.0),V2 (-5.46) 0.24,V2 (-7.23) 0.48)],CurveTo OriginRelative [(V2 (-0.76) 0.1,V2 (-0.86) 5.0e-2,V2 (-2.74) (-1.52))],CurveTo OriginRelative [(V2 (-5.83) (-4.88),V2 (-7.79) (-6.28),V2 (-11.43) (-8.22))],LineTo OriginRelative [V2 (-2.06) (-1.09)],CurveTo OriginRelative [(V2 (-4.07) 4.07,V2 (-8.13) 8.14,V2 (-12.2) 12.2)],CurveTo OriginRelative [(V2 (-0.43) 0.61,V2 (-1.36) (-0.59),V2 (-1.36) (-0.59))],EndPath,MoveTo OriginAbsolute [V2 12.08 38.09],CurveTo OriginAbsolute [(V2 9.87 36.93,V2 7.89 35.81,V2 5.34 34.26)],LineTo OriginRelative [V2 (-1.32) 1.27],CurveTo OriginRelative [(V2 (-0.69) 0.66,V2 (-2.06) 1.62,V2 (-2.83) 2.39)],CurveTo OriginRelative [(V2 (-1.23) 1.22,V2 (-1.55) 1.7,V2 (-2.64) 3.97)],CurveTo OriginRelative [(V2 (-1.13) 2.35,V2 (-1.73) 3.13,V2 (-1.72) 2.23)],CurveTo OriginRelative [(V2 0.0 (-0.59),V2 2.24 (-4.98),V2 3.08 (-6.03))],CurveTo OriginAbsolute [(V2 0.34 37.54,V2 1.64 36.42,V2 2.75 35.56)],LineTo OriginRelative [V2 2.1 (-1.62)],CurveTo OriginRelative [(V2 (-0.82) (-0.75),V2 (-1.56) (-1.42),V2 (-2.22) (-2.15))],CurveTo OriginRelative [(V2 (-0.24) (-0.11),V2 (-3.33) 2.4,V2 (-4.41) 3.59)],CurveTo OriginRelative [(V2 (-0.56) 0.61,V2 (-1.69) 2.2,V2 (-2.51) 3.53)],CurveTo OriginRelative [(V2 (-1.38) 2.23,V2 (-2.01) 2.9,V2 (-2.01) 2.12)],CurveTo OriginRelative [(V2 0.0 (-0.4),V2 2.34 (-4.15),V2 3.54 (-5.68))],CurveTo OriginRelative [(V2 0.52 (-0.66),V2 1.66 (-1.76),V2 2.54 (-2.44))],CurveTo OriginRelative [(V2 0.88 (-0.69),V2 2.24 (-1.63),V2 2.46 (-1.81))],CurveTo OriginAbsolute [(V2 0.28 27.85,V2 (-0.33) 25.78,V2 (-1.53) 23.11)],LineTo OriginRelative [V2 (-2.74) 3.34],CurveTo OriginRelative [(V2 (-3.6) 4.38,V2 (-4.65) 5.87,V2 (-6.31) 8.92)],LineTo OriginRelative [V2 (-1.38) 2.54],CurveTo OriginRelative [(V2 1.17 0.96,V2 8.08 9.41,V2 12.11 12.02)],CurveTo OriginAbsolute [(V2 4.41 45.81,V2 7.57 42.6,V2 12.08 38.09)],EndPath,MoveTo OriginAbsolute [V2 (-1.42) 47.38],CurveTo OriginAbsolute [(V2 0.64 44.18,V2 5.12 37.96,V2 7.9 36.25)],CurveTo OriginRelative [(V2 (-1.8) 3.01,V2 (-5.87) 6.47,V2 (-8.06) 10.31)],CurveTo OriginRelative [(V2 (-0.35) 0.62,V2 (-0.7) 1.02,V2 (-0.91) 1.02)],CurveTo OriginRelative [(V2 (-0.19) 0.0,V2 (-0.34) (-9.0e-2),V2 (-0.34) (-0.2))],EndPath,MoveTo OriginAbsolute [V2 (-8.84) 38.58],CurveTo OriginRelative [(V2 0.0 (-0.4),V2 2.19 (-4.49),V2 2.92 (-5.47))],CurveTo OriginRelative [(V2 1.23 (-1.54),V2 6.51 (-6.88),V2 6.69 (-5.28))],CurveTo OriginRelative [(V2 (-3.25) 2.05,V2 (-7.09) 6.3,V2 (-8.42) 9.74)],CurveTo OriginRelative [(V2 (-0.34) 0.67,V2 (-0.74) 1.22,V2 (-0.9) 1.22)],CurveTo OriginRelative [(V2 (-0.16) 0.0,V2 (-0.29) (-9.0e-2),V2 (-0.29) (-0.21))],EndPath,MoveTo OriginRelative [V2 54.95 9.64],CurveTo OriginRelative [(V2 (-3.23) (-2.26),V2 (-5.17) (-4.08),V2 (-7.41) (-6.94))],CurveTo OriginRelative [(V2 (-0.42) (-0.53),V2 (-0.51) (-0.56),V2 (-4.01) (-0.92))],CurveTo OriginRelative [(V2 (-8.07) (-0.72),V2 (-15.58) (-4.97),V2 (-17.65) (-11.14))],CurveTo OriginRelative [(V2 (-3.79) (-9.46),V2 (-1.57) (-16.54),V2 (-10.35) (-23.62))],CurveTo OriginRelative [(V2 (-0.75) (-0.62),V2 (-2.48) (-1.89),V2 (-3.84) (-2.82))],LineTo OriginAbsolute [V2 0.38 1.08],CurveTo OriginAbsolute [(V2 (-1.88) 9.05,V2 (-2.2) 17.28,V2 (-0.76) 22.8)],CurveTo OriginRelative [(V2 0.97 3.7,V2 2.72 7.34,V2 5.4 9.69)],CurveTo OriginRelative [(V2 3.93 3.44,V2 14.63 7.18,V2 23.73 16.08)],LineTo OriginRelative [V2 1.07 (-0.1)],CurveTo OriginRelative [(V2 6.85 (-0.64),V2 8.92 (-0.56),V2 14.85 0.56)],CurveTo OriginRelative [(V2 1.88 0.36,V2 3.54 0.66,V2 3.7 0.67)],CurveTo OriginRelative [(V2 0.15 1.0e-2,V2 (-0.7) (-0.66),V2 (-1.89) (-1.49))],EndPath,MoveTo OriginRelative [V2 (-11.28) (-3.44)],CurveTo OriginAbsolute [(V2 22.44 39.78,V2 19.05 38.19,V2 15.64 34.76)],CurveTo OriginAbsolute [(V2 11.14 29.46,V2 8.56 23.62,V2 5.99 17.2)],CurveTo OriginRelative [(V2 (-1.3) (-4.86),V2 0.93 0.57,V2 1.62 2.3)],CurveTo OriginRelative [(V2 1.61 4.02,V2 3.42 6.81,V2 4.81 9.38)],CurveTo OriginRelative [(V2 3.91 7.22,V2 9.21 9.97,V2 24.51 15.97)],CurveTo OriginRelative [(V2 2.54 0.99,V2 4.05 1.72,V2 4.05 1.88)],CurveTo OriginRelative [(V2 0.0 0.15,V2 (-0.15) 0.27,V2 (-0.34) 0.26)],CurveTo OriginRelative [(V2 (-0.19) (-0.0),V2 (-2.8) (-1.0),V2 (-5.81) (-2.21))],EndPath,MoveTo OriginAbsolute [V2 0.87 16.76],CurveTo OriginAbsolute [(V2 0.75 15.8,V2 0.41 8.93,V2 1.73 8.64)],CurveTo OriginRelative [(V2 0.3 (-5.0e-2),V2 0.62 0.4,V2 0.92 1.05)],CurveTo OriginRelative [(V2 0.58 1.24,V2 1.09 3.2,V2 1.23 3.64)],LineTo OriginRelative [V2 0.41 1.68],CurveTo OriginAbsolute [(V2 2.83 15.97,V2 1.73 17.32,V2 1.31 17.26)],CurveTo OriginAbsolute [(V2 1.08 17.29,V2 0.95 17.11,V2 0.87 16.76)],EndPath,MoveTo OriginAbsolute [V2 1.35 16.43],CurveTo OriginAbsolute [(V2 2.12 15.68,V2 3.31 15.07,V2 3.74 14.68)],CurveTo OriginAbsolute [(V2 2.82 10.75,V2 2.13 9.23,V2 1.8 9.4)],CurveTo OriginAbsolute [(V2 1.27 11.35,V2 1.22 13.82,V2 1.35 16.43)],EndPath,MoveTo OriginAbsolute [V2 4.43 7.61],CurveTo OriginRelative [(V2 0.54 (-0.49),V2 5.26 3.87,V2 5.26 4.39)],CurveTo OriginRelative [(V2 0.0 0.11,V2 (-0.86) 0.6,V2 (-1.8) 1.04)],CurveTo OriginRelative [(V2 (-0.69) 0.32,V2 (-1.67) 0.79,V2 (-1.83) 0.79)],CurveTo OriginRelative [(V2 (-0.47) (-0.44),V2 (-1.85) (-5.94),V2 (-1.63) (-6.22))],EndPath,MoveTo OriginRelative [V2 0.64 0.83],CurveTo OriginRelative [(V2 (-0.37) (-0.26),V2 0.69 3.53,V2 1.12 4.74)],CurveTo OriginRelative [(V2 1.57 (-0.45),V2 2.8 (-1.37),V2 2.78 (-1.43))],CurveTo OriginAbsolute [(V2 8.01 10.74,V2 5.77 8.75,V2 5.07 8.44)],EndPath,MoveTo OriginRelative [V2 12.28 17.26],CurveTo OriginRelative [(V2 (-0.49) 0.0,V2 (-0.14) (-0.59),V2 0.95 (-1.64))],CurveTo OriginRelative [(V2 0.45 (-0.42),V2 0.84 (-0.76),V2 1.22 (-1.02))],CurveTo OriginRelative [(V2 0.98 (-0.67),V2 1.89 (-0.88),V2 3.47 (-0.91))],LineTo OriginRelative [V2 1.76 (-4.0e-2)],CurveTo OriginRelative [(V2 (-1.0e-2) (-0.81),V2 7.0e-2 (-1.92),V2 (-0.15) (-2.57))],CurveTo OriginRelative [(V2 (-8.0e-2) 5.0e-2,V2 (-1.08) (-0.28),V2 (-1.78) (-0.42))],CurveTo OriginRelative [(V2 (-2.05) (-0.44),V2 (-2.63) (-0.23),V2 (-4.23) 0.53)],CurveTo OriginRelative [(V2 (-1.53) 0.73,V2 (-1.85) 0.95,V2 (-1.85) 0.54)],CurveTo OriginRelative [(V2 0.0 (-0.14),V2 0.71 (-0.6),V2 1.59 (-1.03))],CurveTo OriginRelative [(V2 1.44 (-0.7),V2 1.72 (-0.77),V2 2.98 (-0.74))],CurveTo OriginRelative [(V2 0.77 2.0e-2,V2 1.84 0.21,V2 2.42 0.31)],LineTo OriginRelative [V2 1.14 0.2],CurveTo OriginRelative [(V2 1.0e-2 (-0.23),V2 4.0e-2 (-0.66),V2 6.0e-2 (-1.11))],CurveTo OriginRelative [(V2 3.0e-2 (-0.7),V2 5.0e-2 (-1.45),V2 (-0.0) (-1.67))],CurveTo OriginRelative [(V2 (-1.65) (-0.77),V2 (-3.58) (-1.4),V2 (-5.11) (-1.42))],CurveTo OriginRelative [(V2 (-1.62) (-2.0e-2),V2 (-3.09) 1.0e-2,V2 (-4.29) 0.5)],CurveTo OriginRelative [(V2 (-0.53) 0.22,V2 (-0.83) 0.59,V2 (-1.25) 1.03)],CurveTo OriginRelative [(V2 0.68 2.83,V2 2.39 13.32,V2 4.6 15.35)],CurveTo OriginRelative [(V2 1.93 (-1.93),V2 3.94 (-4.26),V2 5.88 (-6.19))],CurveTo OriginRelative [(V2 0.38 (-1.33),V2 0.13 (-2.71),V2 (-9.0e-2) (-2.74))],CurveTo OriginRelative [(V2 (-3.82) (-0.88),V2 (-6.15) 1.66,V2 (-7.31) 3.03)],EndPath,MoveTo OriginRelative [V2 7.41 (-12.44)],MoveTo OriginRelative [V2 (-1.05) (-0.37)],MoveTo OriginRelative [V2 (-1.96) (-0.69)],CurveTo OriginAbsolute [(V2 20.83 11.87,V2 19.95 11.71,V2 18.99 11.61)],CurveTo OriginAbsolute [(V2 17.87 11.49,V2 16.64 11.46,V2 15.09 11.34)],CurveTo OriginAbsolute [(V2 14.23 11.27,V2 12.48 11.26,V2 12.24 11.21)],CurveTo OriginRelative [(V2 0.24 0.51,V2 0.54 1.09,V2 0.82 1.68)],CurveTo OriginRelative [(V2 0.44 0.91,V2 0.85 1.85,V2 1.03 2.7)],CurveTo OriginRelative [(V2 1.35 (-0.92),V2 2.63 (-1.18),V2 3.85 (-1.29))],CurveTo OriginRelative [(V2 1.44 (-0.13),V2 3.15 0.17,V2 4.49 0.5)],CurveTo OriginRelative [(V2 1.15 0.28,V2 2.02 0.58,V2 2.2 0.63)],CurveTo OriginRelative [(V2 0.22 7.0e-2,V2 0.25 (-0.24),V2 0.23 (-0.69))],CurveTo OriginRelative [(V2 (-2.0e-2) (-0.42),V2 (-9.0e-2) (-0.98),V2 (-9.0e-2) (-1.48))],EndPath,MoveTo OriginRelative [V2 2.47 22.38],CurveTo OriginRelative [(V2 (-0.57) (-0.15),V2 (-1.35) (-0.61),V2 (-2.01) (-1.19))],CurveTo OriginRelative [(V2 (-0.37) (-0.32),V2 (-0.71) (-0.68),V2 (-0.95) (-1.03))],CurveTo OriginRelative [(V2 (-0.2) (-0.3),V2 (-0.33) (-0.59),V2 (-0.34) (-0.85))],CurveTo OriginRelative [(V2 (-5.0e-2) (-0.63),V2 0.83 0.77,V2 1.46 1.42)],CurveTo OriginRelative [(V2 0.21 0.22,V2 0.5 0.42,V2 0.8 0.6)],CurveTo OriginRelative [(V2 0.6 0.36,V2 1.29 0.65,V2 1.64 0.96)],CurveTo OriginRelative [(V2 (-1.0e-2) 0.14,V2 (-0.23) 0.24,V2 (-0.6) 8.0e-2)],EndPath,MoveTo OriginRelative [V2 (-0.31) (-3.62)],CurveTo OriginRelative [(V2 (-0.21) (-0.13),V2 (-0.38) (-0.22),V2 (-0.55) (-0.45))],CurveTo OriginRelative [(V2 (-0.21) (-0.27),V2 (-0.39) (-0.6),V2 (-0.52) (-0.92))],CurveTo OriginRelative [(V2 (-0.28) (-0.69),V2 (-0.47) (-1.32),V2 (-9.0e-2) (-1.32))],CurveTo OriginRelative [(V2 9.0e-2 0.0,V2 0.25 0.39,V2 0.4 0.77)],CurveTo OriginRelative [(V2 0.1 0.26,V2 0.2 0.52,V2 0.26 0.65)],CurveTo OriginRelative [(V2 0.17 0.32,V2 0.56 0.72,V2 0.88 0.88)],CurveTo OriginRelative [(V2 0.15 0.77,V2 (-0.26) 0.46,V2 (-0.39) 0.38)],EndPath]})], _groupViewBox = Nothing, _groupAspectRatio = PreserveAspectRatio {_aspectRatioDefer = False, _aspectRatioAlign = AlignxMidYMid, _aspectRatioMeetSlice = Nothing}})(yet)
-}
{-

MoveTo !Origin ![RPoint]	

M or m command
LineTo !Origin ![RPoint]	

Line to, L or l Svg path command.
HorizontalTo !Origin ![Coord]	
Equivalent to the H or h svg path command.

VerticalTo !Origin ![Coord]	
Equivalent to the V or v svg path command.

CurveTo !Origin ![(RPoint, RPoint, RPoint)]	
Cubic bezier, C or c command

SmoothCurveTo !Origin ![(RPoint, RPoint)]	
Smooth cubic bezier, equivalent to S or s command

QuadraticBezier !Origin ![(RPoint, RPoint)]	
Quadratic bezier, Q or q command

SmoothQuadraticBezierCurveTo !Origin ![RPoint]	
Quadratic bezier, T or t command

EllipticalArc !Origin ![(Coord, Coord, Coord, Bool, Bool, RPoint)]	
Eliptical arc, A or a command.

EndPath	 -- Close the path, Z or z svg path command.

-}
